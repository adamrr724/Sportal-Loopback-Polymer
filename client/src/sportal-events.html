
<link rel="import" href="../bower_components/polymer/polymer.html">

<dom-module id="sportal-events">

    <template>

        <style>
            :host {
                display: block;
                padding: 10px;
            }

            #main-container {
                width:100%;
                height:100vw;
                margin-left: auto;
                margin-right: auto;
                padding: 25px;
                text-align: center;
            }

            .my-events{
                height: 375px;
                width: 300px;
                margin: 20px;
                text-align: center;;
            }

            .events-container {
                width: 90%;
                display: flex;

            }

            .info {
                padding:5px;
            }

            h5 {
                margin-top:5px;
                margin-bottom: 5px;
            }

        </style>
        <template is="dom-if" if="{{signedIn}}">
            <iron-ajax id="userEventGet"
                       auto
                       url="{{getUserEventById}}"
                       handle-as="json"
                       on-error="_onError"
                       on-response="_onResponse"
                       content-type="application/json"
                       debounce-duration="300"
                       method="GET"
                       withCredentials
            ></iron-ajax>

            <paper-card id="main-container" elevation="1">
                <h1>My Events</h1>
                <div>
                    <h3>Find all of your pickup games, leagues, and races here!</h3>
                    <div class="events-container">
                        <template is="dom-repeat" items="{{userEvents}}">
                            <paper-card image="{{item.image}}" class="my-events" elevation="2">
                                <div class="info">
                                    <h4>{{item.name}}</h4>
                                    <h5>{{item.sport}}</h5>
                                    <h5>{{item.eventType}}</h5>
                                </div>
                                <paper-button style="margin:5px; padding:5px; float: right;" raised on-click="_infoModal">More Info</paper-button>
                            </paper-card>
                            <sportal-info-modal signed-in="{{signedIn}}" class="info-modal" info="{{eventInfo}}" modal-opened="{{infoModalOpened}}"></sportal-info-modal>
                        </template>
                    </div>
                </div>
            </paper-card>
        </template>

        <template is="dom-if" if="{{!signedIn}}">
            <h3>Please sign in to see your events!</h3>
        </template>

    </template>

    <script>

        Polymer({

            is: 'sportal-events',

        properties: {

            signedIn: {
                type: Object,
                notify: true
            },

            getUserEventById: {
                type: String,
                computed: 'computeEvents(signedIn)'
            },

            userEvents: {
                type: Object
            },
            eventInfo: {
                type: Object
            },
            infoModalOpened: {
                type:Boolean,
                notify: true,
                value: false
            }

        },

            computeEvents: function(user) {
                return "http://localhost:3000/api/Users/" + user.id + "/events";
            },

            _onResponse: function(e) {
                console.log(e.detail.response);
                this.userEvents= e.detail.response;
                console.log(this.userEvents);
            },

            _infoModal: function(e) {

                this.eventInfo = e.model.__data__.item;

                this.infoModalOpened = true;

            },

        });

    </script>

</dom-module>
