<html><head><link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/google-map/google-map.html">
<link rel="import" href="../bower_components/google-map/google-map-search.html">
<link rel="import" href="../bower_components/google-map/google-map-marker.html">
<link rel="import" href="../bower_components/geo-location/geo-location.html">
<link rel="import" href="../src/elements.html">

</head><body><dom-module id="sportal-map-places">

    <template>

        <style>:host{display:block;}google-map{height:90vh;width:100%;}paper-button{background-color:var(--sportal-blue);margin:10px;}#map-container{display:flex;flex-direction:row;}#search-bar{display:flex;justify-content:center;height:10%;}#filter-container{flex:1 0 0;z-index:1;padding-left:10px;height:100vh;}#map-area{flex:5 0 0;}.filters{width:90%;}.event-type{font-size:16px;font-weight:bold;float:right;}.info-modal{margin-right:auto;margin-left:auto;}.dropdown{margin-right:10px;}</style>

        <iron-ajax id="placeGet" auto="" url="{{requestUrl}}" handle-as="json" on-error="_onError" on-response="_onResponse" content-type="application/json" method="GET" withcredentials=""></iron-ajax>


        <geo-location latitude="{{latitude}}" longitude="{{longitude}}"></geo-location>


            <template is="dom-if" if="{{ajaxResponse}}">
                <paper-card id="map-container">
                    

                        
                        
                        
                            
                        
                    
                    <div id="map-area">
                        <paper-card elevation="0" id="search-bar">

                            <paper-dropdown-menu class="dropdown" label="Facility Type">
                                <paper-listbox attr-for-selected="value" class="dropdown-content" fallback-selection="" selected="{{facilityType}}">
                                    <paper-item value="Multipurpose Fields">Multipurpose Fields</paper-item>
                                    <paper-item value="Soccer Field">Soccer Field</paper-item>
                                    <paper-item value="Basketball Court">Basketball Court</paper-item>
                                    <paper-item value="Baseball Diamond">Baseball Diamond</paper-item>
                                    <paper-item value="Football Field">Football Field</paper-item>
                                    <paper-item value="Track">Track</paper-item>
                                    <paper-item value="Tennis Court">Tennis Court</paper-item>
                                    <paper-item value="Volleyball Court">Volleyball Court</paper-item>
                                    <paper-item value="Ice Rink">Ice Rink</paper-item>
                                    <paper-item value="Squash Court">Squash Court</paper-item>
                                    <paper-item value="Yoga Gym">Yoga Gym</paper-item>
                                    <paper-item value="Pool">Pool</paper-item>
                                    <paper-item value="Fitness Center">Fitness Center</paper-item>
                                    <paper-item value="Walking/Running Trails">Walking/Running Trails</paper-item>
                                    <paper-item value="Hiking Trails">Hiking Trails</paper-item>
                                    <paper-item value="Mountain Bike Trails">Mountain Bike Trails</paper-item>
                                    <paper-item value="Mountain Bike Trails">Skatepark</paper-item>
                                </paper-listbox>
                            </paper-dropdown-menu>

                            <iron-form is="iron-form" id="form">
                                <sportal-gmap-autocomplete location="{{locationData}}"></sportal-gmap-autocomplete>
                                <paper-button raised="" on-click="_selectedFilter">Submit</paper-button>
                            </iron-form>
                        </paper-card>
                        
                        <google-map id="pageMap" map="{{map}}" api-key="AIzaSyD0Oog2e-DQ167WD0Az9gfwaXxYvgrjdNg" single-info-window="true" zoom="10" latitude="{{latitude}}" longitude="{{longitude}}">
                            <template is="dom-repeat" items="[[ajaxResponse]]">
                                <google-map-marker map="{{map}}" latitude="[[item.addressGeo.lat]]" longitude="[[item.addressGeo.lng]]">
                                    <div class="marker-container">
                                        <paper-card class="marker-card" elevation="1">
                                            <h3 style="text-align:center;color:#2d6876" class="marker-headers">[[item.name]]</h3>
                                            <p style="text-align:center" class="event-type"><strong>[[item.facilityType]]</strong></p>
                                                <hr>
                                            <p class="marker-info">Address: [[item.addressName]]</p>
                                            <paper-button style="margin:3px; padding:8px; float: right" raised="" on-click="_infoModal">More Info</paper-button>
                                        </paper-card>

                                    </div>
                                </google-map-marker>
                                <sportal-info-modal-places signed-in="{{signedIn}}" class="info-modal" info="{{placeInfo}}" modal-opened="{{infoModalOpened}}"></sportal-info-modal-places>
                            </template>
                        </google-map>
                    </div>
                </paper-card>
            </template>



        
                   
                   
                   
                   
                   
                   
                   
                   
        

    </template>

    <script>Polymer({is:"sportal-map-places",behaviors:[Polymer.IronMenuBehavior,Polymer.IronFormElementBehavior,Polymer.IronA11yKeysBehavior,Polymer.PaperInputBehavior,Polymer.IronSelectableBehavior,Polymer.IronControlState],listeners:{"iron-select":"_selectedFilter"},properties:{route:Object,ajaxResponse:{type:Object},latitude:{value:"45.512794"},longitude:{value:"-122.679565"},requestUrl:{type:String,value:"http://localhost:3000/api/Places"},facilityType:{value:""},currentLocation:{value:""},locationSelection:{value:""},searchResults:{type:Array},locationInput:{type:String,value:""},locationData:{type:Object},infoModalOpened:{type:Boolean,notify:!0,value:!1},placeInfo:{type:Object},signedIn:{type:Object,notify:!0}},ready:function(){},attached:function(){},_onResponse:function(e){this.ajaxResponse=e.detail.response,console.log(this.ajaxResponse)},_inputChange:function(){},_submitForm:function(){},_infoModal:function(e){this.placeInfo=e.model.__data__.item,this.infoModalOpened=!0},_selectedFilter:function(e){if(1!=e.detail){if("google-map-marker"===e.detail.item.localName)return;this._queryGet()}else this._queryGet()},_queryGet:function(){var e="",t="",i="?filter[where][addressGeo][near]="+this.latitude+","+this.longitude+"&filter[limit]=500";this.locationData?(this.latitude=this.locationData.geometry.location.lat(),this.longitude=this.locationData.geometry.location.lng(),e="//localhost:3000/api/Places??filter[where][addressGeo][near]="+this.latitude+","+this.longitude+"&filter[limit]=500",t=e+"&"):(e="//localhost:3000/api/Places?"+i,t=e+"&");var o="",a="filter[where][facilityType]="+this.facilityType;this.facilityType&&(t+=a,o+=1,this.selectionMade=!0),this.facilityType?this.requestUrl=t:this.requestUrl=e,this.async(function(){this.$.placeGet.generateRequest()},2e3)},_onError:function(e){}});</script>

</dom-module>
</body></html>