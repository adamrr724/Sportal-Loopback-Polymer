(function(t){function e(t){return t&&t.Object===Object?t:null}var n={"function":!0,object:!0},r=n[typeof exports]&&exports&&!exports.nodeType?exports:null,i=n[typeof module]&&module&&!module.nodeType?module:null,s=e(r&&i&&"object"==typeof global&&global),o=e(n[typeof self]&&self),u=e(n[typeof window]&&window),h=(i&&i.exports===r?r:null,e(n[typeof this]&&this)),c=s||u!==(h&&h.window)&&u||o||h||Function("return this")();"function"==typeof define&&define.amd?define(["./rx.lite.compat"],function(e,n){return t(c,n,e)}):"object"==typeof module&&module&&module.exports===r?module.exports=t(c,module.exports,require("rx-lite-compat")):c.Rx=t(c,{},c.Rx)}).call(this,function(t,e,n,r){function i(t){return function(){try{return t.apply(this,arguments)}catch(e){return j.e=e,j}}}function s(t,e){return new k(t,e)}function o(){for(var t=arguments.length,e=new Array(t),n=0;t>n;n++)e[n]=arguments[n];return e}var u=n.Observable,h=u.prototype,c=n.ObservableBase,a=n.internals.AbstractObserver,l=n.FlatMapObservable,f=u.concat,p=u.defer,d=u.empty,_=n.Disposable.empty,y=n.CompositeDisposable,b=n.SerialDisposable,m=n.SingleAssignmentDisposable,v=n.internals.Enumerable,w=v.of,x=n.Scheduler.currentThread,C=n.AsyncSubject,g=n.Observer,A=n.internals.inherits,S=n.internals.addProperties,q=n.helpers,E=q.noop,D=q.isPromise,N=q.isFunction,O=(n.helpers.isIterable,n.helpers.isArrayLike,n.Scheduler.isScheduler),M=u.fromPromise,j={e:{}},F=n.internals.tryCatch=function(t){if(!N(t))throw new TypeError("fn must be a function");return i(t)},R="function"==typeof Symbol&&Symbol.iterator||"_es6shim_iterator_";t.Set&&"function"==typeof(new t.Set)["@@iterator"]&&(R="@@iterator");n.doneEnumerator={done:!0,value:r},n.helpers.isIterable=function(t){return t&&t[R]!==r},n.helpers.isArrayLike=function(t){return t&&t.length!==r};n.helpers.iterator=R;var k=function(t){function e(t,e){this.c=t,this.s=e}return A(e,t),e.prototype[R]=function(){var t=this;return{next:function(){return t.c()?{done:!1,value:t.s}:{done:!0,value:void 0}}}},e}(v);h.letBind=h.let=function(t){return t(this)},u["if"]=function(t,e,n){return p(function(){return n||(n=d()),D(e)&&(e=M(e)),D(n)&&(n=M(n)),"function"==typeof n.now&&(n=d(n)),t()?e:n})},u["for"]=u.forIn=function(t,e,n){return w(t,e,n).concat()};var T=u["while"]=u.whileDo=function(t,e){return D(e)&&(e=M(e)),s(t,e).concat()};h.doWhile=function(t){return f([this,T(t,this)])},u["case"]=function(t,e,n){return p(function(){D(n)&&(n=M(n)),n||(n=d()),O(n)&&(n=d(n));var r=e[t()];return D(r)&&(r=M(r)),r||n})};var I=function(t){function e(e,n,r){this.source=e,this._fn=n,this._scheduler=r,t.call(this)}function n(t,e){var n,r=t[0],i=t[1];if(!(r.q.length>0))return void(r.isAcquired=!1);n=r.q.shift();var s=new m;r.d.add(s),s.setDisposable(n.subscribe(new J(r,i,s))),e([r,i])}return A(e,t),e.prototype._ensureActive=function(t){var e=!1;t.q.length>0&&(e=!t.isAcquired,t.isAcquired=!0),e&&t.m.setDisposable(this._scheduler.scheduleRecursive([t,this],n))},e.prototype.subscribeCore=function(t){var e=new b,n=new y(e),r={q:[],m:e,d:n,activeCount:0,isAcquired:!1,o:t};return r.q.push(this.source),r.activeCount++,this._ensureActive(r),n},e}(c),J=function(t){function e(e,n,r){this._s=e,this._p=n,this._m1=r,t.call(this)}return A(e,t),e.prototype.next=function(t){this._s.o.onNext(t);var e=F(this._p._fn)(t);return e===j?this._s.o.onError(e.e):(this._s.q.push(e),this._s.activeCount++,void this._p._ensureActive(this._s))},e.prototype.error=function(t){this._s.o.onError(t)},e.prototype.completed=function(){this._s.d.remove(this._m1),this._s.activeCount--,0===this._s.activeCount&&this._s.o.onCompleted()},e}(a);h.expand=function(t,e){return O(e)||(e=x),new I(this,t,e)};var P=function(t){function e(e,n){this._sources=e,this._cb=n,t.call(this)}return A(e,t),e.prototype.subscribeCore=function(t){if(0===this._sources.length)return t.onCompleted(),_;for(var e=this._sources.length,n={finished:!1,hasResults:new Array(e),hasCompleted:new Array(e),results:new Array(e)},r=new y,i=0,s=this._sources.length;s>i;i++){var o=this._sources[i];D(o)&&(o=M(o)),r.add(o.subscribe(new B(t,n,i,this._cb,r)))}return r},e}(c),B=function(t){function e(e,n,r,i,s){this._o=e,this._s=n,this._i=r,this._cb=i,this._subs=s,t.call(this)}return A(e,t),e.prototype.next=function(t){this._s.finished||(this._s.hasResults[this._i]=!0,this._s.results[this._i]=t)},e.prototype.error=function(t){this._s.finished=!0,this._o.onError(t),this._subs.dispose()},e.prototype.completed=function(){if(!this._s.finished){if(!this._s.hasResults[this._i])return this._o.onCompleted();this._s.hasCompleted[this._i]=!0;for(var t=0;t<this._s.results.length;t++)if(!this._s.hasCompleted[t])return;this._s.finished=!0;var e=F(this._cb).apply(null,this._s.results);if(e===j)return this._o.onError(e.e);this._o.onNext(e),this._o.onCompleted()}},e}(a);u.forkJoin=function(){for(var t=arguments.length,e=new Array(t),n=0;t>n;n++)e[n]=arguments[n];var r=N(e[t-1])?e.pop():o;return Array.isArray(e[0])&&(e=e[0]),new P(e,r)},h.forkJoin=function(){for(var t=arguments.length,e=new Array(t),n=0;t>n;n++)e[n]=arguments[n];return Array.isArray(e[0])?e[0].unshift(this):e.unshift(this),u.forkJoin.apply(null,e)},h.manySelect=h.extend=function(t,e){O(e)||(e=n.Scheduler.immediate);var r=this;return p(function(){var n;return r.map(function(t){var e=new L(t);return n&&n.onNext(t),n=e,e}).tap(E,function(t){n&&n.onError(t)},function(){n&&n.onCompleted()}).observeOn(e).map(t)},r)};var L=function(t){function e(e){t.call(this),this.head=e,this.tail=new C}return A(e,t),S(e.prototype,g,{_subscribe:function(t){var e=new y;return e.add(x.schedule(this,function(n,r){t.onNext(r.head),e.add(r.tail.mergeAll().subscribe(t))})),e},onCompleted:function(){this.onNext(u.empty())},onError:function(t){this.onNext(u["throw"](t))},onNext:function(t){this.tail.onNext(t),this.tail.onCompleted()}}),e}(u),W=function(t){function e(e){this.source=e,t.call(this)}return A(e,t),e.prototype.subscribeCore=function(t){var e=new m,n=new y,r={hasCurrent:!1,isStopped:!1,o:t,g:n};return n.add(e),e.setDisposable(this.source.subscribe(new z(r))),n},e}(c),z=function(t){function e(e){this._s=e,t.call(this)}function n(e,n){this._s=e,this._i=n,t.call(this)}return A(e,t),e.prototype.next=function(t){if(!this._s.hasCurrent){this._s.hasCurrent=!0,D(t)&&(t=M(t));var e=new m;this._s.g.add(e),e.setDisposable(t.subscribe(new n(this._s,e)))}},e.prototype.error=function(t){this._s.o.onError(t)},e.prototype.completed=function(){this._s.isStopped=!0,!this._s.hasCurrent&&1===this._s.g.length&&this._s.o.onCompleted()},A(n,t),n.prototype.next=function(t){this._s.o.onNext(t)},n.prototype.error=function(t){this._s.o.onError(t)},n.prototype.completed=function(){this._s.g.remove(this._i),this._s.hasCurrent=!1,this._s.isStopped&&1===this._s.g.length&&this._s.o.onCompleted()},e}(a);return h.switchFirst=function(){return new W(this)},h.flatMapFirst=h.exhaustMap=function(t,e,n){return new l(this,t,e,n).switchFirst()},h.flatMapWithMaxConcurrent=h.flatMapMaxConcurrent=function(t,e,n,r){return new l(this,e,n,r).merge(t)},n});