(function(e){function t(e){return e&&e.Object===Object?e:null}var s={"function":!0,object:!0},i=s[typeof exports]&&exports&&!exports.nodeType?exports:null,o=s[typeof module]&&module&&!module.nodeType?module:null,r=t(i&&o&&"object"==typeof global&&global),n=t(s[typeof self]&&self),u=t(s[typeof window]&&window),c=(o&&o.exports===i?i:null,t(s[typeof this]&&this)),l=r||u!==(c&&c.window)&&u||n||c||Function("return this")();"function"==typeof define&&define.amd?define(["./rx.lite.compat"],function(t,s){return e(l,s,t)}):"object"==typeof module&&module&&module.exports===i?module.exports=e(l,module.exports,require("rx-lite-compat")):l.Rx=e(l,{},l.Rx)}).call(this,function(e,t,s,i){function o(e){return function(){try{return e.apply(this,arguments)}catch(t){return d.e=t,d}}}var r=s.Observable,n=r.prototype,u=(s.AnonymousObservable,s.internals.AbstractObserver),c=(s.CompositeDisposable,s.BinaryDisposable),l=(s.NAryDisposable,s.Notification,s.Subject,s.Observer,s.Disposable.empty,s.Disposable.create,s.internals.inherits),p=(s.internals.addProperties,s.Scheduler["default"]),h=(s.Scheduler.currentThread,s.helpers.identity,s.Scheduler.isScheduler,s.helpers.isFunction),d=(s.Disposable.checkDisposed,{e:{}}),b=(s.internals.tryCatch=function(e){if(!h(e))throw new TypeError("fn must be a function");return o(e)},function(e){function t(t){e.call(this),this.source=t}function s(e,t){return t.source.request(1)}l(t,e),t.prototype._subscribe=function(e){return this.subscription=this.source.subscribe(new i(e,this,this.subscription)),new c(this.subscription,p.schedule(this,s))};var i=function(e){function t(t,s,i){e.call(this),this.observer=t,this.observable=s,this.cancel=i,this.scheduleDisposable=null}function s(e,t){return t.observable.source.request(1)}return l(t,e),t.prototype.completed=function(){this.observer.onCompleted(),this.dispose()},t.prototype.error=function(e){this.observer.onError(e),this.dispose()},t.prototype.next=function(e){this.observer.onNext(e),this.scheduleDisposable=p.schedule(this,s)},t.dispose=function(){this.observer=null,this.cancel&&(this.cancel.dispose(),this.cancel=null),this.scheduleDisposable&&(this.scheduleDisposable.dispose(),this.scheduleDisposable=null),e.prototype.dispose.call(this)},t}(u);return t}(r));ControlledObservable.prototype.stopAndWait=function(){return new b(this)};var a=function(e){function t(t,s){e.call(this),this.source=t,this.windowSize=s}function s(e,t){return t.source.request(t.windowSize)}l(t,e),t.prototype._subscribe=function(e){return this.subscription=this.source.subscribe(new i(e,this,this.subscription)),new c(this.subscription,p.schedule(this,s))};var i=function(e){function t(t,s,i){this.observer=t,this.observable=s,this.cancel=i,this.received=0,this.scheduleDisposable=null,e.call(this)}function s(e,t){return t.observable.source.request(t.observable.windowSize)}return l(t,e),t.prototype.completed=function(){this.observer.onCompleted(),this.dispose()},t.prototype.error=function(e){this.observer.onError(e),this.dispose()},t.prototype.next=function(e){this.observer.onNext(e),this.received=++this.received%this.observable.windowSize,0===this.received&&(this.scheduleDisposable=p.schedule(this,s))},t.prototype.dispose=function(){this.observer=null,this.cancel&&(this.cancel.dispose(),this.cancel=null),this.scheduleDisposable&&(this.scheduleDisposable.dispose(),this.scheduleDisposable=null),e.prototype.dispose.call(this)},t}(u);return t}(r);return ControlledObservable.prototype.windowed=function(e){return new a(this,e)},n.pipe=function(e){function t(){s.resume()}var s=this.pausableBuffered();return e.addListener("drain",t),s.subscribe(function(t){!e.write(t)&&s.pause()},function(t){e.emit("error",t)},function(){!e._isStdio&&e.end(),e.removeListener("drain",t)}),s.resume(),e},s});