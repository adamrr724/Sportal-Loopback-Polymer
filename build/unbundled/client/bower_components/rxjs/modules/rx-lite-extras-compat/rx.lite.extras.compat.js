(function(t){function e(t){return t&&t.Object===Object?t:null}var n={"function":!0,object:!0},r=n[typeof exports]&&exports&&!exports.nodeType?exports:null,o=n[typeof module]&&module&&!module.nodeType?module:null,i=e(r&&o&&"object"==typeof global&&global),s=e(n[typeof self]&&self),u=e(n[typeof window]&&window),c=(o&&o.exports===r?r:null,e(n[typeof this]&&this)),f=i||u!==(c&&c.window)&&u||s||c||Function("return this")();"function"==typeof define&&define.amd?define(["./rx.lite.compat"],function(e,n){return t(f,n,e)}):"object"==typeof module&&module&&module.exports===r?module.exports=t(f,module.exports,require("rx-lite-compat")):f.Rx=t(f,{},f.Rx)}).call(this,function(t,e,n,r){function o(t){return function(){try{return t.apply(this,arguments)}catch(e){return G.e=e,G}}}function i(t){throw t}function s(t,e){this.scheduler=t,this.disposable=e,this.isDisposed=!1}function u(t,e){e.isDisposed||(e.isDisposed=!0,e.disposable.dispose())}function c(t,e){return t.amb(e)}function f(t){return t.toArray()}function h(t){return t.length>0}function a(t,e,n){for(var r=0,o=t.length;o>r;r++)if(n(t[r],e))return r;return-1}function l(t){this.comparer=t,this.set=[]}var p=n.Observable,b=p.prototype,d=p.never,_=p["throw"],v=n.AnonymousObservable,w=n.ObservableBase,y=n.AnonymousObserver,m=n.Notification.createOnNext,x=n.Notification.createOnError,C=n.Notification.createOnCompleted,E=n.Observer,N=E.create,g=n.internals.AbstractObserver,A=n.Subject,F=n.internals,O=n.helpers,S=F.ScheduledObserver,D=n.SerialDisposable,k=n.SingleAssignmentDisposable,R=(n.CompositeDisposable,n.BinaryDisposable),q=n.RefCountDisposable,j=n.Disposable.empty,T=n.Scheduler.immediate,B=(O.defaultKeySerializer,n.internals.addRef),M=(O.identity,O.isPromise),W=O.isFunction,I=F.inherits,L=F.bindCallback,P=(O.noop,n.Scheduler.isScheduler),z=p.fromPromise,K=n.ArgumentOutOfRangeError,G={e:{}},H=n.internals.tryCatch=function(t){if(!W(t))throw new TypeError("fn must be a function");return o(t)};s.prototype.dispose=function(){this.scheduler.schedule(this,u)};var J=function(t){function e(e){t.call(this),this._observer=e,this._state=0}I(e,t);var n=e.prototype;return n.onNext=function(t){this.checkAccess();var e=H(this._observer.onNext).call(this._observer,t);this._state=0,e===G&&i(e.e)},n.onError=function(t){this.checkAccess();var e=H(this._observer.onError).call(this._observer,t);this._state=2,e===G&&i(e.e)},n.onCompleted=function(){this.checkAccess();var t=H(this._observer.onCompleted).call(this._observer);this._state=2,t===G&&i(t.e)},n.checkAccess=function(){if(1===this._state)throw new Error("Re-entrancy detected");if(2===this._state)throw new Error("Observer completed");0===this._state&&(this._state=1)},e}(E),Q=function(t){function e(e,n,r){t.call(this,e,n),this._cancel=r}return I(e,t),e.prototype.next=function(e){t.prototype.next.call(this,e),this.ensureActive()},e.prototype.error=function(e){t.prototype.error.call(this,e),this.ensureActive()},e.prototype.completed=function(){t.prototype.completed.call(this),this.ensureActive()},e.prototype.dispose=function(){t.prototype.dispose.call(this),this._cancel&&this._cancel.dispose(),this._cancel=null},e}(S);E.prototype.checked=function(){return new J(this)},E.notifyOn=function(t){return new Q(t,this)},E.fromNotifier=function(t,e){var n=L(t,e,1);return new y(function(t){return n(m(t))},function(t){return n(x(t))},function(){return n(C())})},E.prototype.toNotifier=function(){var t=this;return function(e){return e.accept(t)}},E.prototype.asObserver=function(){var t=this;return new y(function(e){t.onNext(e)},function(e){t.onError(e)},function(){t.onCompleted()})};var U=function(t){function e(e,n){this.source=e,this._s=n,t.call(this)}return I(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new Q(this._s,t))},e}(w);b.observeOn=function(t){return new U(this,t)};var V=function(t){function e(e,n){this.source=e,this._s=n,t.call(this)}function n(t,e){var n=e[0],r=e[1],o=e[2];r.setDisposable(new s(t,n.subscribe(o)))}return I(e,t),e.prototype.subscribeCore=function(t){var e=new k,r=new D;return r.setDisposable(e),e.setDisposable(this._s.schedule([this.source,r,t],n)),r},e}(w);b.subscribeOn=function(t){return new V(this,t)};var X=function(t){function e(e,n,r,o,i){this._initialState=e,this._cndFn=n,this._itrFn=r,this._resFn=o,this._s=i,t.call(this)}function n(t,e){if(t.first)t.first=!1;else if(t.newState=H(t.self._itrFn)(t.newState),t.newState===G)return t.o.onError(t.newState.e);var n=H(t.self._cndFn)(t.newState);if(n===G)return t.o.onError(n.e);if(n){var r=H(t.self._resFn)(t.newState);if(r===G)return t.o.onError(r.e);t.o.onNext(r),e(t)}else t.o.onCompleted()}return I(e,t),e.prototype.subscribeCore=function(t){var e={o:t,self:this,first:!0,newState:this._initialState};return this._s.scheduleRecursive(e,n)},e}(w);p.generate=function(t,e,n,r,o){return P(o)||(o=currentThreadScheduler),new X(t,e,n,r,o)};var Y=function(t){function e(e,n){this._resFn=e,this._obsFn=n,t.call(this)}return I(e,t),e.prototype.subscribeCore=function(t){var e=j,n=H(this._resFn)();if(n===G)return new R(_(n.e).subscribe(t),e);n&&(e=n);var r=H(this._obsFn)(n);return r===G?new R(_(r.e).subscribe(t),e):new R(r.subscribe(t),e)},e}(w);p.using=function(t,e){return new Y(t,e)},b.amb=function(t){var e=this;return new v(function(n){function r(){i||(i=s,f.dispose())}function o(){i||(i=u,c.dispose())}var i,s="L",u="R",c=new k,f=new k;M(t)&&(t=z(t));var h=N(function(t){r(),i===s&&n.onNext(t)},function(t){r(),i===s&&n.onError(t)},function(){r(),i===s&&n.onCompleted()}),a=N(function(t){o(),i===u&&n.onNext(t)},function(t){o(),i===u&&n.onError(t)},function(){o(),i===u&&n.onCompleted()});return c.setDisposable(e.subscribe(h)),f.setDisposable(t.subscribe(a)),new R(c,f)})},p.amb=function(){var t,e=d();if(Array.isArray(arguments[0]))t=arguments[0];else{var n=arguments.length;t=new Array(t);for(var r=0;n>r;r++)t[r]=arguments[r]}for(var r=0,n=t.length;n>r;r++)e=c(e,t[r]);return e},b.onErrorResumeNext=function(t){if(!t)throw new Error("Second observable is required");return tt([this,t])};var Z=function(t){function e(e){this.sources=e,t.call(this)}function n(t,e){if(t.pos<t.sources.length){var n=t.sources[t.pos++];M(n)&&(n=z(n));var r=new k;t.subscription.setDisposable(r),r.setDisposable(n.subscribe(new $(t,e)))}else t.o.onCompleted()}return I(e,t),e.prototype.subscribeCore=function(t){var e=new D,r={pos:0,subscription:e,o:t,sources:this.sources},o=T.scheduleRecursive(r,n);return new R(e,o)},e}(w),$=function(t){function e(e,n){this._state=e,this._recurse=n,t.call(this)}return I(e,t),e.prototype.next=function(t){this._state.o.onNext(t)},e.prototype.error=function(){this._recurse(this._state)},e.prototype.completed=function(){this._recurse(this._state)},e}(g),tt=p.onErrorResumeNext=function(){var t=[];if(Array.isArray(arguments[0]))t=arguments[0];else{var e=arguments.length;t=new Array(e);for(var n=0;e>n;n++)t[n]=arguments[n]}return new Z(t)};b.bufferWithCount=b.bufferCount=function(t,e){return"number"!=typeof e&&(e=t),this.windowWithCount(t,e).flatMap(f).filter(h)},b.windowWithCount=b.windowCount=function(t,e){var n=this;if(+t||(t=0),Math.abs(t)===1/0&&(t=0),0>=t)throw new K;if(null==e&&(e=t),+e||(e=0),Math.abs(e)===1/0&&(e=0),0>=e)throw new K;return new v(function(r){function o(){var t=new A;c.push(t),r.onNext(B(t,s))}var i=new k,s=new q(i),u=0,c=[];return o(),i.setDisposable(n.subscribe(function(n){for(var r=0,i=c.length;i>r;r++)c[r].onNext(n);var s=u-t+1;s>=0&&s%e===0&&c.shift().onCompleted(),++u%e===0&&o()},function(t){for(;c.length>0;)c.shift().onError(t);r.onError(t)},function(){for(;c.length>0;)c.shift().onCompleted();r.onCompleted()})),s},n)};var et=function(t){function e(e,n){this._o=e,this._c=n,this._q=[],t.call(this)}return I(e,t),e.prototype.next=function(t){this._q.push(t),this._q.length>this._c&&this._q.shift()},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){this._o.onNext(this._q),this._o.onCompleted()},e}(g);b.takeLastBuffer=function(t){if(0>t)throw new K;var e=this;return new v(function(n){return e.subscribe(new et(n,t))},e)};var nt=function(t){function e(e,n){this._o=e,this._d=n,this._f=!1,t.call(this)}return I(e,t),e.prototype.next=function(t){this._f=!0,this._o.onNext(t)},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){!this._f&&this._o.onNext(this._d),this._o.onCompleted()},e}(g);b.defaultIfEmpty=function(t){var e=this;return t===r&&(t=null),new v(function(n){return e.subscribe(new nt(n,t))},e)},l.prototype.push=function(t){var e=-1===a(this.set,t,this.comparer);return e&&this.set.push(t),e};var rt=function(t){function e(e,n,r){this.source=e,this._keyFn=n,this._cmpFn=r,t.call(this)}return I(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new ot(t,this._keyFn,this._cmpFn))},e}(w),ot=function(t){function e(e,n,r){this._o=e,this._keyFn=n,this._h=new l(r),t.call(this)}return I(e,t),e.prototype.next=function(t){var e=t;return W(this._keyFn)&&(e=H(this._keyFn)(t),e===G)?this._o.onError(e.e):void(this._h.push(e)&&this._o.onNext(t))},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){this._o.onCompleted()},e}(g);return b.distinct=function(t,e){return e||(e=defaultComparer),new rt(this,t,e)},b.singleInstance=function(){function t(){return r||(r=!0,e=n["finally"](function(){r=!1}).publish().refCount()),e}var e,n=this,r=!1;return new v(function(e){return t().subscribe(e)})},n});