(function(t){function s(t){return t&&t.Object===Object?t:null}var e={"function":!0,object:!0},i=e[typeof exports]&&exports&&!exports.nodeType?exports:null,r=e[typeof module]&&module&&!module.nodeType?module:null,n=s(i&&r&&"object"==typeof global&&global),o=s(e[typeof self]&&self),h=s(e[typeof window]&&window),u=(r&&r.exports===i?i:null,s(e[typeof this]&&this)),c=n||h!==(u&&u.window)&&h||o||u||Function("return this")();"function"==typeof define&&define.amd?define(["./rx"],function(s,e){return t(c,e,s)}):"object"==typeof module&&module&&module.exports===i?module.exports=t(c,module.exports,require("./rx")):c.Rx=t(c,{},c.Rx)}).call(this,function(t,s,e,i){function r(t){for(var s=t.length,e=new Array(s),i=0;s>i;i++)e[i]=t[i];return e}var n=e.Observable,o=n.prototype,h=e.AnonymousObservable,u=e.ObservableBase,c=e.Subject,l=e.AsyncSubject,p=e.Observer,f=e.internals.ScheduledObserver,a=e.Disposable.create,b=e.Disposable.empty,d=e.BinaryDisposable,v=e.Scheduler.currentThread,_=e.helpers.isFunction,w=e.internals.inherits,m=e.internals.addProperties,y=e.Disposable.checkDisposed,S=function(t){function s(s,e,i){this.source=s,this._fn1=e,this._fn2=i,t.call(this)}return w(s,t),s.prototype.subscribeCore=function(t){var s=this.source.multicast(this._fn1());return new d(this._fn2(s).subscribe(t),s.connect())},s}(u);o.multicast=function(t,s){return _(t)?new S(this,t,s):new j(this,t)},o.publish=function(t){return t&&_(t)?this.multicast(function(){return new c},t):this.multicast(new c)},o.share=function(){return this.publish().refCount()},o.publishLast=function(t){return t&&_(t)?this.multicast(function(){return new l},t):this.multicast(new l)},o.publishValue=function(t,s){return 2===arguments.length?this.multicast(function(){return new x(s)},t):this.multicast(new x(t))},o.shareValue=function(t){return this.publishValue(t).refCount()},o.replay=function(t,s,e,i){return t&&_(t)?this.multicast(function(){return new C(s,e,i)},t):this.multicast(new C(s,e,i))},o.shareReplay=function(t,s,e){return this.replay(null,t,s,e).refCount()};var g=function(t,s){this._s=t,this._o=s};g.prototype.dispose=function(){if(!this._s.isDisposed&&null!==this._o){var t=this._s.observers.indexOf(this._o);this._s.observers.splice(t,1),this._o=null}};var x=e.BehaviorSubject=function(t){function s(s){t.call(this),this.value=s,this.observers=[],this.isDisposed=!1,this.isStopped=!1,this.hasError=!1}return w(s,t),m(s.prototype,p.prototype,{_subscribe:function(t){return y(this),this.isStopped?(this.hasError?t.onError(this.error):t.onCompleted(),b):(this.observers.push(t),t.onNext(this.value),new g(this,t))},getValue:function(){return y(this),this.hasError&&thrower(this.error),this.value},hasObservers:function(){return y(this),this.observers.length>0},onCompleted:function(){if(y(this),!this.isStopped){this.isStopped=!0;for(var t=0,s=r(this.observers),e=s.length;e>t;t++)s[t].onCompleted();this.observers.length=0}},onError:function(t){if(y(this),!this.isStopped){this.isStopped=!0,this.hasError=!0,this.error=t;for(var s=0,e=r(this.observers),i=e.length;i>s;s++)e[s].onError(t);this.observers.length=0}},onNext:function(t){if(y(this),!this.isStopped){this.value=t;for(var s=0,e=r(this.observers),i=e.length;i>s;s++)e[s].onNext(t)}},dispose:function(){this.isDisposed=!0,this.observers=null,this.value=null,this.error=null}}),s}(n),C=e.ReplaySubject=function(t){function s(t,s){return a(function(){s.dispose(),!t.isDisposed&&t.observers.splice(t.observers.indexOf(s),1)})}function e(s,e,r){this.bufferSize=null==s?i:s,this.windowSize=null==e?i:e,this.scheduler=r||v,this.q=[],this.observers=[],this.isStopped=!1,this.isDisposed=!1,this.hasError=!1,this.error=null,t.call(this)}var i=Math.pow(2,53)-1;return w(e,t),m(e.prototype,p.prototype,{_subscribe:function(t){y(this);var e=new f(this.scheduler,t),i=s(this,e);this._trim(this.scheduler.now()),this.observers.push(e);for(var r=0,n=this.q.length;n>r;r++)e.onNext(this.q[r].value);return this.hasError?e.onError(this.error):this.isStopped&&e.onCompleted(),e.ensureActive(),i},hasObservers:function(){return y(this),this.observers.length>0},_trim:function(t){for(;this.q.length>this.bufferSize;)this.q.shift();for(;this.q.length>0&&t-this.q[0].interval>this.windowSize;)this.q.shift()},onNext:function(t){if(y(this),!this.isStopped){var s=this.scheduler.now();this.q.push({interval:s,value:t}),this._trim(s);for(var e=0,i=r(this.observers),n=i.length;n>e;e++){var o=i[e];o.onNext(t),o.ensureActive()}}},onError:function(t){if(y(this),!this.isStopped){this.isStopped=!0,this.error=t,this.hasError=!0;var s=this.scheduler.now();this._trim(s);for(var e=0,i=r(this.observers),n=i.length;n>e;e++){var o=i[e];o.onError(t),o.ensureActive()}this.observers.length=0}},onCompleted:function(){if(y(this),!this.isStopped){this.isStopped=!0;var t=this.scheduler.now();this._trim(t);for(var s=0,e=r(this.observers),i=e.length;i>s;s++){var n=e[s];n.onCompleted(),n.ensureActive()}this.observers.length=0}},dispose:function(){this.isDisposed=!0,this.observers=null}}),e}(n),D=function(t){function s(s){this.source=s,this._count=0,this._connectableSubscription=null,t.call(this)}function e(t,s){this._p=t,this._s=s,this.isDisposed=!1}return w(s,t),s.prototype.subscribeCore=function(t){var s=this.source.subscribe(t);return 1===++this._count&&(this._connectableSubscription=this.source.connect()),new e(this,s)},e.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,this._s.dispose(),0===--this._p._count&&this._p._connectableSubscription.dispose())},s}(u),j=e.ConnectableObservable=function(t){function s(s,e){this.source=s,this._connection=null,this._source=s.asObservable(),this._subject=e,t.call(this)}function e(t,s){this._p=t,this._s=s}return w(s,t),e.prototype.dispose=function(){this._s&&(this._s.dispose(),this._s=null,this._p._connection=null)},s.prototype.connect=function(){if(!this._connection){if(this._subject.isStopped)return b;var t=this._source.subscribe(this._subject);this._connection=new e(this,t)}return this._connection},s.prototype._subscribe=function(t){return this._subject.subscribe(t)},s.prototype.refCount=function(){return new D(this)},s}(n);return o.singleInstance=function(){function t(){return i||(i=!0,s=e["finally"](function(){i=!1}).publish().refCount()),s}var s,e=this,i=!1;return new h(function(s){return t().subscribe(s)})},e});