<html><head><link rel="import" href="../bower_components/polymer/polymer.html">

</head><body><dom-module id="sportal-info-modal-events-mysports">

    <template>

        <style>:host{display:flex;}.buttons{padding-bottom:10px;}google-map{height:300px;width:300px;margin-left:auto;margin-right:auto;}paper-dialog{padding:25px;min-height:300px;max-width:600px;text-align:center;}.modal-header{font-weight:400;}#scrollable-area{overflow:auto;width:600px;padding:0;}.info-modal{padding:0;}#info-area{min-height:350px;width:550px;}.info-image{width:100%;box-shadow:1px 1px 1px 1px grey;margin-top:10px;}</style>

            <paper-dialog on-iron-overlay-opened="patchOverlay" class="info-modal" autofitonattach="true" opened="{{modalOpened}}" modal="true">
                <paper-dialog-scrollable id="scrollable-area">
                    <div id="info-area">
                        <template is="dom-if" if="{{info}}">
                                <template is="dom-if" if="[[info.image]]">
                                    <img class="info-image" src="[[info.image]]">
                                </template>
                                <h1 class="modal-header">[[info.name]]</h1>
                                <p class="event-info">Event Type: [[info.eventType]]</p>
                                <p class="event-info">Sport: [[info.sport]]</p>
                                <template is="dom-if" if="[[info.otherSport]]">
                                    <p class="event-info">Sport Name: [[info.otherSport]]</p>
                                </template>
                                <p class="event-info">Skill Level: [[info.skillLevel]]</p>
                                <p class="event-info">Age: [[info.age]]</p>
                                <template is="dom-if" if="[[info.recurring]]">
                                    <p class="event-info">Is this a recurring Event?: Yes</p>
                                </template>
                                <template is="dom-if" if="[[!info.recurring]]">
                                    <p class="event-info">Is this a recurring Event?: No</p>
                                </template>
                                <template is="dom-if" if="[[info.recurringDate]]">
                                    <p class="event-info">Date of the Week: [[info.recurringDate]]</p>
                                    <p class="event-info">Starting Date: {{startingDate}}</p>
                                    <p class="event-info">Ending Date: {{date}}</p>
                                </template>
                                <template is="dom-if" if="[[!info.recurringDate]]">
                                    <p class="event-info">Date: {{date}}</p>
                                </template>
                                <template is="dom-if" if="[[info.fees]]">
                                    <p class="event-info">Fees?: Yes</p>
                                </template>
                                <template is="dom-if" if="[[!info.fees]]">
                                    <p class="event-info">Fees?: No</p>
                                </template>
                                <template is="dom-if" if="[[info.addressName]]">
                                    <p class="event-info">Address: [[info.addressName]]</p>
                                </template>
                                <template is="dom-if" if="[[info.addressGeo]]">
                                    <google-map zoom="14" latitude="[[info.addressGeo.lat]]" longitude="[[info.addressGeo.lng]]" api-key="AIzaSyD0Oog2e-DQ167WD0Az9gfwaXxYvgrjdNg">
                                        <google-map-marker latitude="[[info.addressGeo.lat]]" longitude="[[info.addressGeo.lng]]"></google-map-marker>
                                    </google-map>
                                </template>
                                <template is="dom-if" if="[[info.organization]]">
                                    <p class="event-info">Affiliated Organization: [[info.organization]]</p>
                                </template>
                                <template is="dom-if" if="[[info.website]]">
                                    <p class="event-info">Website: <a href="http://[[info.website]]">[[info.website]]</a></p>
                                </template>
                                <template is="dom-if" if="[[info.notes]]">
                                    <p class="event-info">Notes: [[info.notes]]</p>
                                </template>
                                <p class="event-info"><a href="mailto:[[info.email]]?subject=[[info.name]]">Contact the Organizer!</a></p>
                                <sportal-event-users id="eventUsers" following="[[following]]" event-id="[[info.id]]"></sportal-event-users>
                        </template>
                    </div>
                </paper-dialog-scrollable>
                <div class="buttons">

                    <template is="dom-if" if="{{signedIn}}">
                        <template is="dom-if" if="{{!following}}">
                            <paper-button raised="" class="follow" on-click="_follow" autofocus=""><strong>Add to my Events</strong></paper-button>
                        </template>
                        <template is="dom-if" if="{{following}}">
                            <paper-button raised="" class="follow" on-click="_unfollow" autofocus=""><strong>Unfollow</strong></paper-button>
                        </template>
                    </template>
                    <paper-button class="text-close" on-click="_modalClose" autofocus=""><strong>Close</strong></paper-button>
                </div>
            </paper-dialog>

            <iron-ajax id="userEventGet" auto="" url="{{getUserEventById}}" handle-as="json" on-error="_onError" on-response="_onResponse" content-type="application/json" debounce-duration="300" method="GET" withcredentials=""></iron-ajax>

            <iron-ajax id="userEventPut" url="{{userEventPutUrl}}" on-error="_onError" on-response="_onResponseGet" method="PUT"></iron-ajax>

            <iron-ajax id="userEventDelete" url="{{userEventDeleteUrl}}" handle-as="json" on-error="_onError" on-response="_onResponseGet" content-type="application/json" debounce-duration="300" method="DELETE" withcredentials=""></iron-ajax>


    </template>

    <script>Polymer({is:"sportal-info-modal-events-mysports",properties:{modalOpened:{type:Boolean,notify:!0},info:{type:Object,notify:!0},eventId:{type:Object,notify:!0},following:{type:Boolean,observer:"_followingChange"},followChanged:{type:Boolean,value:!1},getUserEventById:{type:String,computed:"computeId(info)"},ajaxResponse:{type:Object},signedIn:{type:Object,notify:!0},joinObject:{type:Object},userEventObject:{type:Object},userEventDeleteUrl:{type:String},userEventPutUrl:{type:String},date:{type:String,computed:"dateFormat(info)"},startingDate:{type:String,computed:"startingDateFormat(info)"}},startingDateFormat:function(t){return moment(t.startDate).utc().format("dddd, MMMM Do YYYY, h:mm a")},dateFormat:function(t){return moment(t.date).utc().format("dddd, MMMM Do YYYY, h:mm a")},computeId:function(t){return"http://localhost:3000/api/Events/"+this.info.id+"/users/"+this.signedIn.id},_followingChange:function(){console.log(this.followChanged),this.followChanged=!0},_modalClose:function(){1==this.followChanged?(this.modalOpened=!1,this.followChanged=!1,location.reload()):this.modalOpened=!1},patchOverlay:function(t){t.target.withBackdrop&&t.target.parentNode.insertBefore(t.target.backdropElement,t.target)},_follow:function(t){this.userEventPutUrl="http://localhost:3000/api/Events/"+this.info.id+"/users/rel/"+this.signedIn.id,this.$.userEventPut.generateRequest(),this.following=!0},_unfollow:function(t){this.userEventDeleteUrl="http://localhost:3000/api/Events/"+this.info.id+"/users/rel/"+this.signedIn.id,this.$.userEventDelete.generateRequest(),this.following=!1},_onResponse:function(t){this.following=!0},_onResponseGet:function(t){this.$.userEventGet.generateRequest()},_onError:function(t){404===t.detail.request.__data__.response.error.status&&(this.following=!1)}});</script>

</dom-module>
</body></html>