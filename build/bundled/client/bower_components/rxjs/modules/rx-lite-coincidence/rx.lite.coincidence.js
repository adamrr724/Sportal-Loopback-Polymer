(function(n){function e(n){return n&&n.Object===Object?n:null}var t={"function":!0,object:!0},r=t[typeof exports]&&exports&&!exports.nodeType?exports:null,o=t[typeof module]&&module&&!module.nodeType?module:null,i=e(r&&o&&"object"==typeof global&&global),u=e(t[typeof self]&&self),s=e(t[typeof window]&&window),c=(o&&o.exports===r?r:null,e(t[typeof this]&&this)),f=i||s!==(c&&c.window)&&s||u||c||Function("return this")();"function"==typeof define&&define.amd?define(["./rx.lite"],function(e,t){return n(f,t,e)}):"object"==typeof module&&module&&module.exports===r?module.exports=n(f,module.exports,require("rx-lite")):f.Rx=n(f,{},f.Rx)}).call(this,function(n,e,t,r){function o(n){return function(){try{return n.apply(this,arguments)}catch(e){return z.e=e,z}}}function i(n){return n.toArray()}function u(n,e){return n.groupJoin(this,e,y,function(n,e){return e})}function s(n){var e=this;return new x(function(t){var r=new w,o=new p,i=new d(o);return t.onNext(_(r,i)),o.add(e.subscribe(function(n){r.onNext(n)},function(n){r.onError(n),t.onError(n)},function(){r.onCompleted(),t.onCompleted()})),N(n)&&(n=O(n)),o.add(n.subscribe(function(n){r.onCompleted(),r=new w,t.onNext(_(r,i))},function(n){r.onError(n),t.onError(n)},function(){r.onCompleted(),t.onCompleted()})),i},e)}function c(n){var e=this;return new x(function(t){function r(){var e;try{e=n()}catch(i){return void t.onError(i)}N(e)&&(e=O(e));var c=new b;o.setDisposable(c),c.setDisposable(e.take(1).subscribe(k,function(n){s.onError(n),t.onError(n)},function(){s.onCompleted(),s=new w,t.onNext(_(s,u)),r()}))}var o=new v,i=new p(o),u=new d(i),s=new w;return t.onNext(_(s,u)),i.add(e.subscribe(function(n){s.onNext(n)},function(n){s.onError(n),t.onError(n)},function(){s.onCompleted(),t.onCompleted()})),r(),u},e)}var f=t.Observable,a=t.ObservableBase,l=t.internals.AbstractObserver,p=t.CompositeDisposable,h=t.BinaryDisposable,d=t.RefCountDisposable,b=t.SingleAssignmentDisposable,v=t.SerialDisposable,w=t.Subject,E=f.prototype,y=f.empty,m=f.never,x=t.AnonymousObservable,_=t.internals.addRef,C=t.internals.inherits,g=t.internals.bindCallback,k=t.helpers.noop,N=t.helpers.isPromise,D=t.helpers.isFunction,O=f.fromPromise,z={e:{}},j=t.internals.tryCatch=function(n){if(!D(n))throw new TypeError("fn must be a function");return o(n)},B=n.Map||function(){function n(){this.size=0,this._values=[],this._keys=[]}return n.prototype["delete"]=function(n){var e=this._keys.indexOf(n);return-1===e?!1:(this._values.splice(e,1),this._keys.splice(e,1),this.size--,!0)},n.prototype.get=function(n){var e=this._keys.indexOf(n);return-1===e?r:this._values[e]},n.prototype.set=function(n,e){var t=this._keys.indexOf(n);return-1===t?(this._keys.push(n),this._values.push(e),this.size++):this._values[t]=e,this},n.prototype.forEach=function(n,e){for(var t=0;t<this.size;t++)n.call(e,this._values[t],this._keys[t])},n}();E.join=function(n,e,t,r){var o=this;return new x(function(i){var u=new p,s=!1,c=!1,f=0,a=0,l=new B,h=new B,d=function(n){i.onError(n)};return u.add(o.subscribe(function(n){var t=f++,o=new b;l.set(t,n),u.add(o);var c=j(e)(n);return c===z?i.onError(c.e):(o.setDisposable(c.take(1).subscribe(k,d,function(){l["delete"](t)&&0===l.size&&s&&i.onCompleted(),u.remove(o)})),void h.forEach(function(e){var t=j(r)(n,e);return t===z?i.onError(t.e):void i.onNext(t)}))},d,function(){s=!0,(c||0===l.size)&&i.onCompleted()})),u.add(n.subscribe(function(n){var e=a++,o=new b;h.set(e,n),u.add(o);var s=j(t)(n);return s===z?i.onError(s.e):(o.setDisposable(s.take(1).subscribe(k,d,function(){h["delete"](e)&&0===h.size&&c&&i.onCompleted(),u.remove(o)})),void l.forEach(function(e){var t=j(r)(e,n);return t===z?i.onError(t.e):void i.onNext(t)}))},d,function(){c=!0,(s||0===h.size)&&i.onCompleted()})),u},o)},E.groupJoin=function(n,e,t,r){var o=this;return new x(function(i){function u(n){}var s=new p,c=new d(s),f=new B,a=new B,l=0,h=0,u=function(n){return function(e){e.onError(n)}};return s.add(o.subscribe(function(n){var t=new w,o=l++;f.set(o,t);var p=j(r)(n,_(t,c));if(p===z)return f.forEach(u(p.e)),i.onError(p.e);i.onNext(p),a.forEach(function(n){t.onNext(n)});var h=new b;s.add(h);var d=j(e)(n);return d===z?(f.forEach(u(d.e)),i.onError(d.e)):void h.setDisposable(d.take(1).subscribe(k,function(n){f.forEach(u(n)),i.onError(n)},function(){f["delete"](o)&&t.onCompleted(),s.remove(h)}))},function(n){f.forEach(u(n)),i.onError(n)},function(){i.onCompleted()})),s.add(n.subscribe(function(n){var e=h++;a.set(e,n);var r=new b;s.add(r);var o=j(t)(n);return o===z?(f.forEach(u(o.e)),i.onError(o.e)):(r.setDisposable(o.take(1).subscribe(k,function(n){f.forEach(u(n)),i.onError(n)},function(){a["delete"](e),s.remove(r)})),void f.forEach(function(e){e.onNext(n)}))},function(n){f.forEach(u(n)),i.onError(n)})),c},o)},E.buffer=function(){return this.window.apply(this,arguments).flatMap(i)},E.window=function(n,e){return 1===arguments.length&&"function"!=typeof arguments[0]?s.call(this,n):"function"==typeof n?c.call(this,n):u.call(this,n,e)};var A=function(n){function e(e){this.source=e,n.call(this)}return C(e,n),e.prototype.subscribeCore=function(n){return this.source.subscribe(new R(n))},e}(a),R=function(n){function e(e){this._o=e,this._p=null,this._hp=!1,n.call(this)}return C(e,n),e.prototype.next=function(n){this._hp?this._o.onNext([this._p,n]):this._hp=!0,this._p=n},e.prototype.error=function(n){this._o.onError(n)},e.prototype.completed=function(){this._o.onCompleted()},e}(l);E.pairwise=function(){return new A(this)},E.partition=function(n,e){var t=g(n,e,3);return[this.filter(n,e),this.filter(function(n,e,r){return!t(n,e,r)})]},E.groupBy=function(n,e){return this.groupByUntil(n,e,m)},E.groupByUntil=function(n,e,t){var o=this;return new x(function(i){var u=new B,s=new p,c=new d(s),f=function(n){return function(e){e.onError(n)}};return s.add(o.subscribe(function(o){var a=j(n)(o);if(a===z)return u.forEach(f(a.e)),i.onError(a.e);var l=!1,p=u.get(a);if(p===r&&(p=new w,u.set(a,p),l=!0),l){var h=new T(a,p,c),d=new T(a,p),v=j(t)(d);if(v===z)return u.forEach(f(v.e)),i.onError(v.e);i.onNext(h);var E=new b;s.add(E),E.setDisposable(v.take(1).subscribe(k,function(n){u.forEach(f(n)),i.onError(n)},function(){u["delete"](a)&&p.onCompleted(),s.remove(E)}))}var y=o;return D(e)&&(y=j(e)(o),y===z)?(u.forEach(f(y.e)),i.onError(y.e)):void p.onNext(y)},function(n){u.forEach(f(n)),i.onError(n)},function(){u.forEach(function(n){n.onCompleted()}),i.onCompleted()})),c},o)};var S=function(n){function e(e,t){this._m=e,this._u=t,n.call(this)}return C(e,n),e.prototype.subscribeCore=function(n){return new h(this._m.getDisposable(),this._u.subscribe(n))},e}(a),T=function(n){function e(e,t,r){n.call(this),this.key=e,this.underlyingObservable=r?new S(r,t):t}return C(e,n),e.prototype._subscribe=function(n){return this.underlyingObservable.subscribe(n)},e}(f);return t});